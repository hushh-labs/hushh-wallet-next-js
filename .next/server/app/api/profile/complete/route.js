"use strict";(()=>{var e={};e.id=910,e.ids=[910],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2308:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>_,originalPathname:()=>I,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>b});var o={};r.r(o),r.d(o,{OPTIONS:()=>c,POST:()=>d});var a=r(5419),s=r(9108),n=r(9678),i=r(8070),l=r(6517),u=r(5635);async function p(e,t,r={}){try{await l.p.from("pass_events").insert({uid:e,type:t,meta_json:r})}catch(e){console.error("Failed to log event:",e)}}async function d(e){try{let{uid:t,token:r,city:o,state:a,zip:s,gender:n,age:d,street1:c}=await e.json();if(!t||!r)return i.Z.json({error:"UID and token are required."},{status:400});let{data:f,error:m}=await l.p.from("members").select("uid, edit_token_hash, name").eq("uid",t).single();if(m||!f)return i.Z.json({error:"Member not found."},{status:404});if(!(0,u.Tl)(r,f.edit_token_hash))return i.Z.json({error:"Invalid or expired token."},{status:403});let h={},g=[];if(o&&(h.profile_city=o.trim()),a&&(/^[A-Z]{2}$/.test(a.toUpperCase())?h.profile_state=a.toUpperCase():g.push("State must be a 2-letter US state code (e.g., CA, NY).")),s&&(/^\d{5}(-?\d{4})?$/.test(s)?h.profile_zip=s:g.push("ZIP code must be 5 digits or 5+4 format (e.g., 12345 or 12345-6789).")),n&&(["male","female","m","f"].includes(n.toLowerCase())?h.profile_gender=function(e){let t=e.toLowerCase();return"m"===t||"male"===t?"male":"f"===t||"female"===t?"female":t}(n):g.push("Gender must be male/female or M/F.")),void 0!==d&&(Number.isInteger(d)&&d>=13&&d<=120?h.profile_age=d:g.push("Age must be between 13 and 120.")),c&&(h.profile_street1=c.trim()),g.length>0)return i.Z.json({error:"Validation failed.",details:g},{status:400});if(0===Object.keys(h).length)return await p(t,"profile_opened",{user_agent:e.headers.get("user-agent")}),i.Z.json({ok:!0,message:"Profile accessed successfully.",member:f.name});h.profile_last_updated_at=new Date().toISOString();try{let{error:r}=await l.p.from("members").update(h).eq("uid",t);if(r)return console.error("Failed to update member profile:",r),i.Z.json({error:"Failed to update profile."},{status:500});return await p(t,"profile_saved",{user_agent:e.headers.get("user-agent"),fields_updated:Object.keys(h).filter(e=>"profile_last_updated_at"!==e),profile_complete:!!(h.profile_city&&h.profile_state&&h.profile_zip&&h.profile_gender&&h.profile_age)}),i.Z.json({ok:!0,message:"Profile updated successfully.",member:f.name,updated_fields:Object.keys(h).filter(e=>"profile_last_updated_at"!==e)})}catch(e){return console.error("Database error during profile update:",e),i.Z.json({error:"Database operation failed."},{status:500})}}catch(e){return console.error("Profile completion API error:",e),i.Z.json({error:"Internal server error."},{status:500})}}async function c(){return i.Z.json({},{status:200})}let f=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/profile/complete/route",pathname:"/api/profile/complete",filename:"route",bundlePath:"app/api/profile/complete/route"},resolvedPagePath:"/Users/ankitkumarsingh/Desktop/hushh social card/hushh-gold-pass-mvp/src/app/api/profile/complete/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:g,headerHooks:_,staticGenerationBailout:b}=f,I="/api/profile/complete/route";function v(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},6517:(e,t,r)=>{r.d(t,{p:()=>a});var o=r(9224);(0,o.eI)("https://xicjnlrlbvqzlhtjzuuo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhpY2pubHJsYnZxemxodGp6dXVvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwODg4MDIsImV4cCI6MjA3ODY2NDgwMn0.UMRHaXfrnpTPJYrvFBxOJbEoW6GgMD3bsyz0ziwnAr4");let a=(0,o.eI)("https://xicjnlrlbvqzlhtjzuuo.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})},5635:(e,t,r)=>{r.d(t,{pq:()=>a,Ux:()=>n,AH:()=>u,D:()=>s,IR:()=>i,Tl:()=>l});let o=require("crypto");function a(e){let t=e.email.toLowerCase().trim(),r=e.name.trim().replace(/\s+/g," "),o=function(e){let t=e.replace(/\D/g,"");return 10===t.length?`+1${t}`:11===t.length&&t.startsWith("1")?`+1${t.substring(1)}`:null}(e.phone);return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)&&r.trim().length>0&&o?{name:r,email:t,phone_e164:o}:null}function s(e){let t=process.env.UID_SECRET_SALT;if(!t)throw Error("UID_SECRET_SALT environment variable is required");let r=e.name.toLowerCase(),a=`${e.email}|${e.phone_e164}|${r}`,s=(0,o.createHmac)("sha256",t);s.update(a);let n=s.digest().subarray(0,20),i=0n;for(let e=0;e<n.length;e++)i=(i<<8n)+BigInt(n[e]);return i.toString(36)}function n(){return(0,o.randomBytes)(16).toString("hex")}function i(e){return(0,o.createHash)("sha256").update(e).digest("hex")}function l(e,t){return i(e)===t}function u(e,t){let r="https://hushh-gold-pass-mvp.vercel.app";return{public_url:`${r}/u/${e}`,profile_url:`${r}/complete/${e}?token=${t}`}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[638,431],()=>r(2308));module.exports=o})();