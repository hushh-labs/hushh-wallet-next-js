"use strict";(()=>{var e={};e.id=768,e.ids=[768],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8277:(e,a,t)=>{t.r(a),t.d(a,{headerHooks:()=>S,originalPathname:()=>A,patchFetch:()=>N,requestAsyncStorage:()=>v,routeModule:()=>E,serverHooks:()=>M,staticGenerationAsyncStorage:()=>I,staticGenerationBailout:()=>k});var n={};t.r(n),t.d(n,{GET:()=>w,OPTIONS:()=>b});var i=t(5419),r=t(9108),s=t(9678),o=t(8070),l=t(6517);class c{constructor(){this.baseUrl="https://api.stlouisfed.org/fred",this.nationalIncomeSeries={household_nominal:"MEHOINUSA646N",household_real:"MEHOINUSA672N",personal_nominal:"MEPAINUSA646N",personal_real:"MEPAINUSA672N",family_nominal:"MEFAINUSA646N"},this.apiKey=process.env.FRED_API_KEY||null}async fetchSeries(e,a,t){if(!this.apiKey)return console.warn("FRED API key not configured, using fallback data"),null;try{let n=new URLSearchParams({series_id:e,api_key:this.apiKey,file_type:"json",sort_order:"desc",limit:"1"});a&&n.set("observation_start",a),t&&n.set("observation_end",t);let i=`${this.baseUrl}/series/observations?${n.toString()}`,r=await fetch(i);if(!r.ok)return console.error(`FRED API error: ${r.status} ${r.statusText}`),null;return await r.json()}catch(e){return console.error("FRED API fetch error:",e),null}}async getNationalIncomeMedians(){try{let[e,a,t]=await Promise.all([this.fetchSeries(this.nationalIncomeSeries.household_nominal),this.fetchSeries(this.nationalIncomeSeries.personal_nominal),this.fetchSeries(this.nationalIncomeSeries.family_nominal)]),n={household_nominal:null,personal_nominal:null,family_nominal:null,year:null};if(e?.observations?.[0]){let a=e.observations[0];"."!==a.value&&(n.household_nominal=parseFloat(a.value),n.year=parseInt(a.date.substring(0,4)))}if(a?.observations?.[0]){let e=a.observations[0];"."!==e.value&&(n.personal_nominal=parseFloat(e.value))}if(t?.observations?.[0]){let e=t.observations[0];"."!==e.value&&(n.family_nominal=parseFloat(e.value))}return n}catch(e){return console.error("Error fetching national income medians:",e),null}}async updateMacroIncomeBaselines(){try{let e=await this.getNationalIncomeMedians();if(!e||!e.household_nominal||!e.year)return console.warn("Insufficient FRED data for macro income baselines update"),!1;let{data:a,error:t}=await l.p.from("macro_income_baselines").upsert({year:e.year,median_household_income_nominal:e.household_nominal,median_personal_income_nominal:e.personal_nominal,median_family_income_nominal:e.family_nominal,source_updated_at:new Date().toISOString(),source_release:"Income and Poverty in the United States",updated_at:new Date().toISOString()},{onConflict:"year"});if(t)return console.error("Error updating macro income baselines:",t),!1;return console.log(`Updated macro income baselines for year ${e.year}`),!0}catch(e){return console.error("Error in updateMacroIncomeBaselines:",e),!1}}async getCurrentMUsNominal(){try{let{data:e,error:a}=await l.p.from("layer1_income_baselines").select("M_us_nominal, year").order("year",{ascending:!1}).limit(1).single();if(a||!e){if(console.warn("No macro income baselines found, fetching from FRED"),await this.updateMacroIncomeBaselines()){let{data:e,error:a}=await l.p.from("layer1_income_baselines").select("M_us_nominal").order("year",{ascending:!1}).limit(1).single();if(!a&&e)return e.M_us_nominal}return 8e4}return e.M_us_nominal}catch(e){return console.error("Error getting current M_us_nominal:",e),8e4}}async getStateMedianIncome(e){let a=`MEHOINUSA${e}A646N`;try{let e=await this.fetchSeries(a);if(e&&e.observations&&e.observations.length>0){let a=e.observations[0].value;return"."!==a?parseFloat(a):null}}catch(a){console.error(`Error fetching state income for ${e}:`,a)}return null}async getNationalNetWorthData(){return[{median_net_worth:39e3,p25_net_worth:8e3,p75_net_worth:92e3,p90_net_worth:4e5,year:2022,age_group:"18-34",source:"SCF_2022"},{median_net_worth:135e3,p25_net_worth:15e3,p75_net_worth:35e4,p90_net_worth:104e4,year:2022,age_group:"35-44",source:"SCF_2022"},{median_net_worth:246e3,p25_net_worth:45e3,p75_net_worth:6e5,p90_net_worth:196e4,year:2022,age_group:"45-54",source:"SCF_2022"},{median_net_worth:364e3,p25_net_worth:84e3,p75_net_worth:9e5,p90_net_worth:28e5,year:2022,age_group:"55-64",source:"SCF_2022"},{median_net_worth:41e4,p25_net_worth:1e5,p75_net_worth:975e3,p90_net_worth:32e5,year:2022,age_group:"65-74",source:"SCF_2022"},{median_net_worth:335e3,p25_net_worth:7e4,p75_net_worth:75e4,p90_net_worth:24e5,year:2022,age_group:"75+",source:"SCF_2022"}]}async getUnemploymentRate(e){let a=`${e}UR`;try{let e=await this.fetchSeries(a);if(e&&e.observations&&e.observations.length>0){let a=e.observations[0].value;return"."!==a?parseFloat(a):null}}catch(a){console.error(`Error fetching unemployment rate for ${e}:`,a)}return null}async calculateEnhancedGeoMultiplier(e){let a=e.toUpperCase(),t={CA:1.4,NY:1.4,MA:1.4,CT:1.4,NJ:1.4,WA:1.4,MD:1.4,TX:1.1,FL:1.1,VA:1.1,CO:1.1,IL:1.1,NC:1.1}[a]||1,n=t,i={base_multiplier:t,uses_fred_baseline:!1};try{let e=await this.getCurrentMUsNominal();e&&(i.m_us_nominal=e,i.uses_fred_baseline=!0);let[t,r]=await Promise.all([this.getStateMedianIncome(a),this.getUnemploymentRate(a)]);if(null!==t&&e){i.median_income=t;let a=t/e;n=Math.sqrt(a)}else null!==t&&(i.median_income=t,n=Math.sqrt(t/8e4));null!==r&&(i.unemployment_rate=r,n*=Math.max(.8,1-(r-4)/20))}catch(e){console.error("Error calculating enhanced geo multiplier:",e)}return{multiplier:Math.max(.5,Math.min(2,n)),factors:i}}async refreshNationalMedians(){try{if(await this.updateMacroIncomeBaselines())return{success:!0,message:"Successfully updated national income medians from FRED"};return{success:!1,message:"Failed to update national income medians - using cached values"}}catch(e){return console.error("Error in refreshNationalMedians:",e),{success:!1,message:`Error refreshing national medians: ${e instanceof Error?e.message:"Unknown error"}`}}}}let _=new c;class u{constructor(){this.baseUrl="https://api.census.gov/data/2023/acs/acs5",this.fallbackNationalMedian=8e4,this.apiKey=process.env.CENSUS_API_KEY||null}async getNationalMedian(){try{let e=await _.getCurrentMUsNominal();if(e&&e>0)return{value:e,source:"FRED_REAL_TIME"}}catch(e){console.warn("Failed to get FRED national median, using fallback:",e)}return{value:this.fallbackNationalMedian,source:"FALLBACK_STATIC"}}buildUrl(e,a){let t=new URLSearchParams({...a,...this.apiKey?{key:this.apiKey}:{}});return`${this.baseUrl}${e}?${t.toString()}`}async fetchCensusData(e,a){try{let t=this.buildUrl(e,a),n=await fetch(t);if(!n.ok)throw Error(`Census API error: ${n.status} ${n.statusText}`);return{data:await n.json()}}catch(e){return console.error("Census API fetch error:",e),{error:e instanceof Error?e.message:"Unknown error"}}}async getZipMedianIncome(e){if(!this.apiKey)return console.warn("Census API key not configured"),null;try{let a=await this.fetchCensusData("",{get:"NAME,B19013_001E",for:`zip code tabulation area:${e}`});if(a.data&&a.data.length>1){let e=a.data[1][1];return e&&"-666666666"!==e?parseInt(e):null}}catch(a){console.error(`Error fetching median income for ZIP ${e}:`,a)}return null}async getComprehensiveZipData(e){if(!this.apiKey)return console.warn("Census API key not configured, using fallback estimates"),null;try{let[a,t,n,i,r]=await Promise.all([this.fetchCensusData("",{get:"NAME,B19013_001E",for:`zip code tabulation area:${e}`}),this.fetchCensusData("",{get:"NAME,B19113_001E",for:`zip code tabulation area:${e}`}),this.fetchCensusData("",{get:"NAME,B19001_001E,B19001_002E,B19001_003E,B19001_004E,B19001_005E,B19001_006E,B19001_007E,B19001_008E,B19001_009E,B19001_010E,B19001_011E,B19001_012E,B19001_013E,B19001_014E,B19001_015E,B19001_016E,B19001_017E",for:`zip code tabulation area:${e}`}),this.fetchCensusData("",{get:"NAME,B19080_001E,B19080_002E,B19080_003E,B19080_004E,B19080_005E",for:`zip code tabulation area:${e}`}),this.fetchCensusData("",{get:"NAME,B19083_001E",for:`zip code tabulation area:${e}`})]),s=this.parseNumericValue(a.data,1,1),o=this.parseNumericValue(t.data,1,1),l=this.parseNumericValue(n.data,1,1),c=this.parseIncomeDistribution(n.data),_=this.parseQuintiles(i.data,r.data),u=.5;return null!==s&&(u+=.2),null!==l&&l>100&&(u+=.1),c&&Object.values(c).some(e=>e>0)&&(u+=.1),null!==_.gini_index&&(u+=.1),{zcta:e,median_household_income:s,median_family_income:o,total_households:l,income_distribution:c||this.getDefaultDistribution(),quintiles:_,data_year:2023,confidence_level:Math.min(u,1)}}catch(a){return console.error(`Error fetching comprehensive data for ZIP ${e}:`,a),null}}parseNumericValue(e,a,t){if(!e||e.length<=a||e[a].length<=t)return null;let n=e[a][t];return n&&"-666666666"!==n&&"."!==n?parseInt(n):null}parseIncomeDistribution(e){if(!e||e.length<=1)return null;let a=e[1];if(a.length<18)return null;try{return{under_10k:parseInt(a[2]||"0"),k10_15:parseInt(a[3]||"0"),k15_25:parseInt(a[4]||"0"),k25_35:parseInt(a[5]||"0"),k35_50:parseInt(a[6]||"0")+parseInt(a[7]||"0"),k50_75:parseInt(a[8]||"0")+parseInt(a[9]||"0"),k75_100:parseInt(a[10]||"0")+parseInt(a[11]||"0"),k100_150:parseInt(a[12]||"0")+parseInt(a[13]||"0"),k150_200:parseInt(a[14]||"0"),over_200k:parseInt(a[15]||"0")+parseInt(a[16]||"0")+parseInt(a[17]||"0")}}catch(e){return null}}parseQuintiles(e,a){let t={q1_upper_limit:null,q2_upper_limit:null,q3_upper_limit:null,q4_upper_limit:null,q5_mean:null,gini_index:null};if(e&&e.length>1&&(e[1],t.q1_upper_limit=this.parseNumericValue(e,1,2),t.q2_upper_limit=this.parseNumericValue(e,1,3),t.q3_upper_limit=this.parseNumericValue(e,1,4),t.q4_upper_limit=this.parseNumericValue(e,1,5)),a&&a.length>1){let e=a[1][1];t.gini_index=e&&"."!==e?parseFloat(e):null}return t}getDefaultDistribution(){return{under_10k:0,k10_15:0,k15_25:0,k25_35:0,k35_50:0,k50_75:0,k75_100:0,k100_150:0,k150_200:0,over_200k:0}}async calculateAffluenceMetrics(e){let a=await this.getNationalMedian(),t=a.value,n=e.median_household_income||t,i=e.income_distribution,r=Object.values(i).reduce((e,a)=>e+a,0),s=i.k150_200+i.over_200k,o=i.over_200k,l=i.k75_100+i.k100_150+i.k150_200+i.over_200k,c=r>0?s/r:0,_=r>0?o/r:0,u=n/t;return{affluence_score:Math.min(1,.5*u+.3*(.4*c+.6*_)+.2*(e.quintiles.gini_index?Math.max(0,(e.quintiles.gini_index-.4)*2):0)),wealth_indicators:{above_median_rate:r>0?l/r:.5,high_income_rate:c,very_high_income_rate:_,gini_coefficient:e.quintiles.gini_index||.4},comparison_to_national:{median_income_ratio:u,percentile_rank:Math.min(99,Math.max(1,50+(u-1)*30+40*c)),uses_fred_baseline:"FRED_REAL_TIME"===a.source}}}async calculateZipBasedMultiplier(e){try{let a=await this.getComprehensiveZipData(e);if(!a||a.confidence_level<.3){let a=await this.getZipMedianIncome(e);if(a){let e=await this.getNationalMedian(),t=a/e.value;return{multiplier:Math.max(.6,Math.min(2.5,Math.sqrt(t))),factors:{median_income:a,affluence_index_zip:t,m_us_nominal:e.value,confidence_level:.3,data_source:"CENSUS_ACS_BASIC",uses_fred_baseline:"FRED_REAL_TIME"===e.source}}}return this.estimateFromZipPattern(e)}let t=await this.calculateAffluenceMetrics(a),n=Math.sqrt(t.comparison_to_national.median_income_ratio);n*=1+.5*t.affluence_score,t.wealth_indicators.very_high_income_rate>.15?n*=1.3:t.wealth_indicators.high_income_rate>.25&&(n*=1.15);let i=Math.max(.5,Math.min(2,n)),r=await this.getNationalMedian();return{multiplier:i,factors:{median_income:a.median_household_income||void 0,affluence_score:t.affluence_score,high_income_rate:t.wealth_indicators.high_income_rate,confidence_level:a.confidence_level,affluence_index_zip:t.comparison_to_national.median_income_ratio,m_us_nominal:r.value,data_source:"CENSUS_ACS_COMPREHENSIVE",uses_fred_baseline:t.comparison_to_national.uses_fred_baseline}}}catch(a){return console.error(`Error calculating ZIP multiplier for ${e}:`,a),this.estimateFromZipPattern(e)}}estimateFromZipPattern(e){return{multiplier:({0:1.2,1:1.1,2:1,3:.9,4:.9,5:.8,6:.9,7:.9,8:1,9:1.3})[parseInt(e.charAt(0))]||1,factors:{data_source:"ZIP_PATTERN_FALLBACK",confidence_level:.1}}}async calculateAffluenceIndexZip(e){try{let[a,t]=await Promise.all([this.getZipMedianIncome(e),this.getNationalMedian()]);if(!a)return null;let n=a/t.value;return{affluence_index_zip:Math.max(.5,Math.min(2,n)),m_zip:a,m_us_nominal:t.value,confidence:a>0?.8:.2,uses_fred_baseline:"FRED_REAL_TIME"===t.source}}catch(a){return console.error(`Error calculating affluence index for ZIP ${e}:`,a),null}}}let d=new u;class h{constructor(){this.baseUrl="https://api.bls.gov/publicAPI/v2/timeseries/data/",this.ageSeries={"16plus":"LEU0252881500","25_34":"LEU0252888500","35_44":"LEU0252889100","45_54":"LEU0252889700","55_64":"LEU0252890900","65plus":"LEU0252891500"},this.nationalMedianWeekly=1145,this.apiKey=process.env.BLS_API_KEY||null}async fetchBLSData(e){try{let a=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,...this.apiKey?{registrationkey:this.apiKey}:{}})});if(!a.ok)throw Error(`BLS API error: ${a.status} ${a.statusText}`);let t=await a.json();if("REQUEST_SUCCEEDED"!==t.status)throw Error(`BLS API failed: ${t.message?.join(", ")||"Unknown error"}`);return t}catch(e){return console.error("BLS API fetch error:",e),null}}async getAgeEarnings(e,a=new Date().getFullYear()-1){if(!this.apiKey)return console.warn("BLS API key not configured, using fallback estimates"),this.getFallbackEarnings(e,a);let t=this.ageSeries[e];if(!t)return console.error(`No BLS series ID found for age band: ${e}`),null;try{let n={seriesid:[t],startyear:a.toString(),endyear:a.toString(),annualaverage:!0,catalog:!1,calculations:!1,aspects:!1},i=await this.fetchBLSData(n);if(!i||!i.Results?.series?.length)return this.getFallbackEarnings(e,a);let r=i.Results.series[0].data.find(e=>e.year===a.toString()&&e.period.startsWith("A"));if(!r||!r.value||"."===r.value)return this.getFallbackEarnings(e,a);let s=parseFloat(r.value),o=s/this.nationalMedianWeekly;return{age_band:e,bls_series_id:t,year:a,median_weekly_nominal_usd:s,median_annual_income_usd:52*s,age_income_index:o,source_survey:"CPS Weekly and Hourly Earnings",confidence_level:.9}}catch(t){return console.error(`Error fetching BLS data for age band ${e}:`,t),this.getFallbackEarnings(e,a)}}async getAllAgeEarnings(e=new Date().getFullYear()-1){let a={};if(!this.apiKey){for(let t of(console.warn("BLS API key not configured, using fallback data for all age bands"),Object.keys(this.ageSeries))){let n=this.getFallbackEarnings(t,e);n&&(a[t]=n)}return a}try{let t={seriesid:Object.values(this.ageSeries),startyear:e.toString(),endyear:e.toString(),annualaverage:!0,catalog:!1,calculations:!1,aspects:!1},n=await this.fetchBLSData(t);if(!n||!n.Results?.series?.length){for(let t of Object.keys(this.ageSeries)){let n=this.getFallbackEarnings(t,e);n&&(a[t]=n)}return a}for(let t of n.Results.series){let n=Object.keys(this.ageSeries).find(e=>this.ageSeries[e]===t.seriesID);if(!n)continue;let i=t.data.find(a=>a.year===e.toString()&&a.period.startsWith("A"));if(i&&i.value&&"."!==i.value){let r=parseFloat(i.value),s=52*r,o=r/this.nationalMedianWeekly;a[n]={age_band:n,bls_series_id:t.seriesID,year:e,median_weekly_nominal_usd:r,median_annual_income_usd:s,age_income_index:o,source_survey:"CPS Weekly and Hourly Earnings",confidence_level:.9}}else{let t=this.getFallbackEarnings(n,e);t&&(a[n]=t)}}return a}catch(t){for(let n of(console.error("Error fetching BLS batch data:",t),Object.keys(this.ageSeries))){let t=this.getFallbackEarnings(n,e);t&&(a[n]=t)}return a}}getFallbackEarnings(e,a){let t={"16plus":1145,"25_34":1051,"35_44":1350,"45_54":1298,"55_64":1200,"65plus":950}[e];if(!t)return null;let n=t/this.nationalMedianWeekly;return{age_band:e,bls_series_id:this.ageSeries[e]||"FALLBACK",year:a,median_weekly_nominal_usd:t,median_annual_income_usd:52*t,age_income_index:n,source_survey:"BLS_2023_FALLBACK",confidence_level:.4}}mapAgeToAgeBand(e){return e<25?"16plus":e<35?"25_34":e<45?"35_44":e<55?"45_54":e<65?"55_64":"65plus"}calculateAgeIncomeMultiplier(e){return Math.max(.7,Math.min(1.4,Math.sqrt(e)))}analyzeAgeIncome(e,a){let t=this.mapAgeToAgeBand(e),n=this.calculateAgeIncomeMultiplier(a.age_income_index),i="average";return a.age_income_index>1.2&&(i="above_average"),a.age_income_index<.8&&(i="below_average"),a.age_income_index>1.5&&(i="well_above_average"),{age_band:t,weekly_earnings:a.median_weekly_nominal_usd,annual_income_est:a.median_annual_income_usd,national_comparison:i,income_multiplier:n,confidence:a.confidence_level}}}let m=new h;async function p(e,a,t={}){try{await l.p.from("pass_events").insert({uid:e,type:a,meta_json:t})}catch(e){console.error("Failed to log event:",e)}}async function g(e){var a;let t=e.profile_age||30,n=e.profile_zip,i=e.profile_state,r=!!e.profile_street1,s=t<35?"18-34":t<45?"35-44":t<55?"45-54":t<65?"55-64":t<75?"65-74":"75+";try{let o=function(e){let a=e.replace(/\D/g,"").slice(0,5);return 5===a.length?a:null}(n),l=m.mapAgeToAgeBand(t),[c,u,h,p]=await Promise.all([_.getNationalNetWorthData(),_.calculateEnhancedGeoMultiplier(i),o?d.calculateZipBasedMultiplier(o):null,m.getAgeEarnings(l)]),g=c.find(e=>e.age_group===s);if(!g)throw Error(`No data found for age group: ${s}`);let f=u.multiplier,y=u.factors,w=null;h&&h.factors.confidence_level&&h.factors.confidence_level>.3&&(f=h.multiplier,w=h.factors,u.factors.unemployment_rate&&u.factors.median_income&&(f=.7*h.multiplier+.3*u.multiplier));let b=1,E=null;p&&(a=p.age_income_index,b=m.calculateAgeIncomeMultiplier(a),E=m.analyzeAgeIncome(t,p));let v=1;r&&(v=1.3);let I=f*v*Math.pow(b,.25),M=g.median_net_worth*I,S=g.p90_net_worth*I,k=Math.round(g.p25_net_worth*I),A=Math.round((M+g.p75_net_worth*I)/2),N=.4;t&&i&&(N+=.2),n&&(N+=.1),r&&(N+=.2),e.profile_city&&(N+=.1),y.median_income&&(N+=.1),y.unemployment_rate&&(N+=.05),w&&(N+=.15,w.affluence_score&&w.affluence_score>.5&&(N+=.05)),E&&(N+=.05,E.confidence>.8&&(N+=.05));let C={age_band:s,nw_median_age:g.median_net_worth,nw_p25_age:g.p25_net_worth,nw_p75_age:g.p75_net_worth,nw_p90_age:g.p90_net_worth,geo_multiplier:f,geo_factors:y,zip_factors:w,age_income_multiplier:b,age_earnings_factors:E,address_multiplier:v,has_address:r,state:i,zip:n,valid_zip:o,data_source:g.source,data_year:g.year,fred_enhanced:!0,census_enhanced:!!w,bls_enhanced:!!E};return{networth_low_usd:k,networth_high_usd:Math.round(1.1*S),networth_mid_usd:A,confidence_0_1:Math.min(N,.8),signals:C}}catch(m){console.error("FRED API error, falling back to static data:",m);let a={"18-34":{median:39e3,p80:17e4,p90:4e5},"35-44":{median:135e3,p80:55e4,p90:104e4},"45-54":{median:246e3,p80:85e4,p90:196e4},"55-64":{median:364e3,p80:12e5,p90:28e5},"65-74":{median:41e4,p80:13e5,p90:32e5},"75+":{median:335e3,p80:95e4,p90:24e5}}[s],o=1;["CA","NY","MA","CT","NJ","WA","MD"].includes(i)?o=1.4:["TX","FL","VA","CO","IL","NC"].includes(i)&&(o=1.1);let l=1;r&&(l=1.3);let c=a.median*o*l,_=a.p80*o*l,u=Math.round(.7*c),d=Math.round(1.2*_),h=.3;return t&&i&&(h+=.2),n&&(h+=.1),r&&(h+=.2),e.profile_city&&(h+=.1),{networth_low_usd:u,networth_high_usd:d,networth_mid_usd:Math.round((u+d)/2),confidence_0_1:Math.min(h,.8),signals:{age_band:s,nw_median_age:a.median,nw_p80_age:a.p80,geo_multiplier:o,address_multiplier:l,has_address:r,state:i,zip:n,data_source:"SCF_2022_FALLBACK",fred_enhanced:!1,fallback_reason:m instanceof Error?m.message:"Unknown error"}}}}async function f(e,a){let{networth_low_usd:t,networth_high_usd:n,confidence_0_1:i,signals:r}=e,s=(e,a)=>{let t=e=>e>=1e6?`$${Math.round(e/1e5)/10}M`:`$${Math.round(e/1e3)}k`;return`${t(e)} - ${t(a)}`},o=process.env.CLAUDE_API_KEY;if(o)try{let e={profile:{age:a.profile_age,state:a.profile_state,zip:a.profile_zip,city:a.profile_city,has_address:r.has_address},layer1_estimate:{low:t,high:n,confidence:i},signals:r},l=`You are a financial estimation engine for HUSHH. Analyze the provided demographic and statistical data to refine a net worth estimate.

CONTEXT: You have Layer-1 statistical data based on Federal Reserve SCF data, age demographics, and geographic indicators.

TASK: Provide a refined estimate with human-readable reasoning.

CONSTRAINTS:
- Always provide a range, never a point estimate
- Base reasoning on demographic patterns and economic indicators
- Include confidence assessment
- Be transparent about limitations
- Keep reasoning concise but informative

Respond with JSON only:
{
  "final_estimate_low": number,
  "final_estimate_high": number,
  "band_label": "string like $X-$Y",
  "reasoning_summary": "concise explanation",
  "confidence_0_1": 0.1-0.8,
  "disclaimer": "standard disclaimer"
}`,c=`Profile: Age ${e.profile.age}, ${e.profile.state} state${e.profile.has_address?", homeowner indicator":""}
Layer-1 estimate: $${(e.layer1_estimate.low/1e3).toFixed(0)}k - $${(e.layer1_estimate.high/1e3).toFixed(0)}k
Signals: ${JSON.stringify(e.signals)}

Refine this estimate and provide reasoning.`,_=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":o,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-haiku-20240307",max_tokens:1e3,system:l,messages:[{role:"user",content:c}]})});if(_.ok){let e=(await _.json()).content[0].text;try{let a=JSON.parse(e);if(a.final_estimate_low&&a.final_estimate_high&&a.reasoning_summary)return{final_estimate_low:Math.round(a.final_estimate_low),final_estimate_high:Math.round(a.final_estimate_high),band_label:a.band_label||s(a.final_estimate_low,a.final_estimate_high),reasoning_summary:a.reasoning_summary,confidence_0_1:Math.min(Math.max(a.confidence_0_1||i,.1),.8),disclaimer:a.disclaimer||"This is an AI-powered estimate based on demographic and regional data, not your actual financial accounts. Individual circumstances vary significantly. Not financial advice."}}catch(e){console.error("Failed to parse Claude response:",e)}}}catch(e){console.error("Claude API error:",e)}let l=`Based on your age (${a.profile_age}) and location (${a.profile_state}), `;return l+=`you fall into the ${r.age_band} demographic where median net worth is around $${(r.nw_median_age/1e3).toFixed(0)}k. `,r.geo_multiplier>1.2&&(l+="Your state has higher-than-average income levels, which typically correlates with higher net worth. "),r.has_address&&(l+="Having a street address suggests homeownership, and homeowners in your age group typically have 30-50% higher net worth due to real estate equity. "),l+="This estimate combines Federal Reserve Survey of Consumer Finances data with regional economic indicators.",{final_estimate_low:t,final_estimate_high:n,band_label:s(t,n),reasoning_summary:l,confidence_0_1:i,disclaimer:"This is an estimate based on demographic and regional data, not your actual financial accounts. Individual circumstances vary significantly. Not financial advice."}}async function y(e,a,t){try{let n={uid:e,method:"ai_estimated",layer1_low:a.networth_low_usd,layer1_high:a.networth_high_usd,layer1_confidence:a.confidence_0_1,layer1_signals_json:a.signals,final_low:t.final_estimate_low,final_high:t.final_estimate_high,final_confidence:t.confidence_0_1,band_label:t.band_label,reasoning:t.reasoning_summary,disclaimer:t.disclaimer,estimated_at:new Date().toISOString(),expires_at:new Date(Date.now()+864e5).toISOString()},{error:i}=await l.p.from("networth_estimates").upsert(n,{onConflict:"uid"});i&&console.error("Failed to store estimate:",i)}catch(e){console.error("Error storing estimate:",e)}}async function w(e){try{let{searchParams:a}=e.nextUrl,t=a.get("uid");if(!t)return o.Z.json({error:"UID parameter is required"},{status:400});let{data:n,error:i}=await l.p.from("members").select("*").eq("uid",t).single();if(i||!n)return o.Z.json({error:"Member not found"},{status:404});if("active"!==n.pass_status)return o.Z.json({error:"Pass is not active"},{status:403});await p(t,"networth_requested",{user_agent:e.headers.get("user-agent"),ip:e.headers.get("x-forwarded-for")||"unknown"});let r=function(e){let a=[],t=[];for(let n of["profile_age","profile_state","profile_zip"])e[n]?t.push(n):a.push(n.replace("profile_",""));for(let a of["profile_city","profile_street1","profile_gender"])e[a]&&t.push(a);return{complete:0===a.length,missing:a}}(n);if(!r.complete){let e=r.missing.join(","),a=`/complete/${t}?required=${e}&return=/networth/${t}`;return o.Z.json({error:"Profile incomplete",message:`Please complete your profile first. Missing: ${r.missing.join(", ")}`,missing_fields:r.missing,redirect_url:a,action:"redirect_to_profile"},{status:400})}let{data:s}=await l.p.from("networth_estimates").select("*").eq("uid",t).gte("estimated_at",new Date(Date.now()-864e5).toISOString()).order("estimated_at",{ascending:!1}).limit(1).single();if(s&&!a.get("refresh"))return await p(t,"networth_served_cached",{}),o.Z.json({uid:s.uid,estimateLow:s.final_low,estimateHigh:s.final_high,bandLabel:s.band_label,confidence:s.final_confidence,reasoning:s.reasoning,disclaimer:s.disclaimer,lastUpdated:s.estimated_at,cached:!0});let c=await g(n),_=await f(c,n);return await y(t,c,_),await p(t,"networth_estimated",{method:"ai_estimated",confidence:_.confidence_0_1,band:_.band_label}),o.Z.json({uid:t,estimateLow:_.final_estimate_low,estimateHigh:_.final_estimate_high,bandLabel:_.band_label,confidence:_.confidence_0_1,reasoning:_.reasoning_summary,disclaimer:_.disclaimer,lastUpdated:new Date().toISOString(),cached:!1})}catch(a){return console.error("Net worth estimation error:",a),e.nextUrl.searchParams.get("uid")&&await p(e.nextUrl.searchParams.get("uid"),"networth_error",{error:a instanceof Error?a.message:"Unknown error"}),o.Z.json({error:"Internal server error"},{status:500})}}async function b(){return o.Z.json({},{status:200})}let E=new i.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/networth/estimate/route",pathname:"/api/networth/estimate",filename:"route",bundlePath:"app/api/networth/estimate/route"},resolvedPagePath:"/Users/ankitkumarsingh/Desktop/hushh social card/hushh-gold-pass-mvp/src/app/api/networth/estimate/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:v,staticGenerationAsyncStorage:I,serverHooks:M,headerHooks:S,staticGenerationBailout:k}=E,A="/api/networth/estimate/route";function N(){return(0,s.patchFetch)({serverHooks:M,staticGenerationAsyncStorage:I})}},6517:(e,a,t)=>{t.d(a,{p:()=>i});var n=t(9224);(0,n.eI)("https://ntwdvvzjkmabujwxlzej.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im50d2R2dnpqa21hYnVqd3hsemVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzE3MTM4NTcsImV4cCI6MjA0NzI4OTg1N30.vQCDCT-yJjOhBjCvJk7Q5mJGwpMjkKHqo7LDZgG3lBI");let i=(0,n.eI)("https://ntwdvvzjkmabujwxlzej.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),n=a.X(0,[638,206,224],()=>t(8277));module.exports=n})();