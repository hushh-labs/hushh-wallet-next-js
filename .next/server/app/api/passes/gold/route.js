"use strict";(()=>{var e={};e.id=687,e.ids=[687],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1561:(e,r,a)=>{a.r(r),a.d(r,{headerHooks:()=>b,originalPathname:()=>v,patchFetch:()=>I,requestAsyncStorage:()=>h,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>f});var s={};a.r(s),a.d(s,{GET:()=>u,OPTIONS:()=>d});var t=a(5419),o=a(9108),i=a(9678),n=a(8070),l=a(6517);async function p(e,r,a={}){try{await l.p.from("pass_events").insert({uid:e,type:r,meta_json:a})}catch(e){console.error("Failed to log event:",e)}}async function u(e){try{let{searchParams:r}=e.nextUrl,a=r.get("uid");if(!a)return n.Z.json({error:"UID parameter is required"},{status:400});let{data:s,error:t}=await l.p.from("members").select("*").eq("uid",a).single();if(t||!s)return n.Z.json({error:"Member not found"},{status:404});if("active"!==s.pass_status)return n.Z.json({error:"Pass is not active"},{status:403});let o={passType:"storeCard",organizationName:"HUSHH",description:"HUSHH Gold Pass",serialNumber:`gold-${a}`,teamIdentifier:"HUSHH",backgroundColor:"rgb(117, 65, 10)",foregroundColor:"rgb(255, 248, 235)",labelColor:"rgb(216, 178, 111)",logoText:"HUSHH",headerFields:[{key:"brand",value:"HUSHH",textAlignment:"PKTextAlignmentRight"}],primaryFields:[{key:"tier",label:"TIER",value:"GOLD"}],secondaryFields:[{key:"member",label:"MEMBER",value:s.name}],backFields:[{key:"profile",label:"Complete your profile",value:s.profile_url},{key:"verify",label:"Verification",value:s.public_url}],barcode:{message:s.public_url,format:"PKBarcodeFormatQR",messageEncoding:"iso-8859-1",altText:`HUSHH Gold Pass - ${a}`},sharingProhibited:!0,maxDistance:100,relevantDate:new Date().toISOString()};try{let r=process.env.HUSHH_WALLET_API_URL||"https://hushh-wallet.vercel.app/api/passes/universal/create",t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!t.ok){let e=await t.text();return console.error("Hushh Wallet API error:",t.status,e),await p(a,"api_error",{error:"wallet_api_failed",status:t.status,message:e}),n.Z.json({error:"Failed to generate pass"},{status:500})}let i=t.headers.get("x-pass-serial")||t.headers.get("pass-serial")||`gold-${a}`;i&&i!==s.pass_serial&&await l.p.from("members").update({pass_serial:i}).eq("uid",a),await p(a,"pass_issued",{pass_serial:i,user_agent:e.headers.get("user-agent")});let u=await t.arrayBuffer();return new n.Z(u,{status:200,headers:{"Content-Type":"application/vnd.apple.pkpass","Content-Disposition":`attachment; filename="hushh-gold-${a}.pkpass"`,"Cache-Control":"no-cache"}})}catch(e){return console.error("Failed to call Hushh Wallet API:",e),await p(a,"api_error",{error:"wallet_api_failed",message:e instanceof Error?e.message:"Unknown error"}),n.Z.json({error:"Pass generation service unavailable"},{status:503})}}catch(e){return console.error("Pass generation error:",e),n.Z.json({error:"Internal server error"},{status:500})}}async function d(){return n.Z.json({},{status:200})}let c=new t.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/passes/gold/route",pathname:"/api/passes/gold",filename:"route",bundlePath:"app/api/passes/gold/route"},resolvedPagePath:"/Users/ankitkumarsingh/Desktop/hushh social card/hushh-gold-pass-mvp/src/app/api/passes/gold/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:m,headerHooks:b,staticGenerationBailout:f}=c,v="/api/passes/gold/route";function I(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},6517:(e,r,a)=>{a.d(r,{p:()=>t});var s=a(9224);(0,s.eI)("https://xicjnlrlbvqzlhtjzuuo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhpY2pubHJsYnZxemxodGp6dXVvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwODg4MDIsImV4cCI6MjA3ODY2NDgwMn0.UMRHaXfrnpTPJYrvFBxOJbEoW6GgMD3bsyz0ziwnAr4");let t=(0,s.eI)("https://xicjnlrlbvqzlhtjzuuo.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),s=r.X(0,[638,431],()=>a(1561));module.exports=s})();