"use strict";(()=>{var e={};e.id=687,e.ids=[687],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1561:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>v,originalPathname:()=>b,patchFetch:()=>I,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>y});var a={};r.r(a),r.d(a,{GET:()=>c,OPTIONS:()=>d});var s=r(5419),o=r(9108),n=r(9678),i=r(8070),l=r(6517);async function p(e,t,r={}){try{await l.p.from("pass_events").insert({uid:e,type:t,meta_json:r})}catch(e){console.error("Failed to log event:",e)}}function u(e){if(!e)return"";let t=e.replace(/\s+/g,"").trim();try{new URL(t).protocol}catch(e){console.error("Invalid URL format:",t)}return t}async function c(e){try{let{searchParams:t}=e.nextUrl,r=t.get("uid");if(!r)return i.Z.json({error:"UID parameter is required"},{status:400});let{data:a,error:s}=await l.p.from("members").select("*").eq("uid",r).single();if(s||!a)return i.Z.json({error:"Member not found"},{status:404});if("active"!==a.pass_status)return i.Z.json({error:"Pass is not active"},{status:403});let o=process.env.NEXT_PUBLIC_APP_URL||"https://hushh-gold-pass-mvp.vercel.app",n={passType:"storeCard",organizationName:"HUSHH",description:"HUSHH Gold Pass",serialNumber:`gold-${r}`,teamIdentifier:"HUSHH",backgroundColor:"rgb(117, 65, 10)",foregroundColor:"rgb(255, 248, 235)",labelColor:"rgb(216, 178, 111)",logoText:"HUSHH",headerFields:[{key:"brand",value:"HUSHH",textAlignment:"PKTextAlignmentRight"}],primaryFields:[{key:"tier",label:"TIER",value:"GOLD"}],secondaryFields:[{key:"member",label:"MEMBER",value:a.name}],backFields:[{key:"profile",label:"Complete your profile",value:u(a.profile_url),dataDetectorTypes:["PKDataDetectorTypeLink"],textAlignment:"PKTextAlignmentLeft"},{key:"networth",label:"Know your net worth",value:u(`${o}/networth/${r}`),dataDetectorTypes:["PKDataDetectorTypeLink"],textAlignment:"PKTextAlignmentLeft"},{key:"verify",label:"Verification",value:u(a.public_url),dataDetectorTypes:["PKDataDetectorTypeLink"],textAlignment:"PKTextAlignmentLeft"}],barcode:{message:u(a.public_url),format:"PKBarcodeFormatQR",messageEncoding:"utf-8",altText:`HUSHH Gold Pass - ${r}`},sharingProhibited:!0,maxDistance:100,relevantDate:new Date().toISOString()};try{let t=process.env.HUSHH_WALLET_API_URL||"http://localhost:3001/api/passes/universal/create",s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok){let e=await s.text();return console.error("Hushh Wallet API error:",s.status,e),await p(r,"api_error",{error:"wallet_api_failed",status:s.status,message:e}),i.Z.json({error:"Failed to generate pass"},{status:500})}let o=s.headers.get("x-pass-serial")||s.headers.get("pass-serial")||`gold-${r}`;o&&o!==a.pass_serial&&await l.p.from("members").update({pass_serial:o}).eq("uid",r),await p(r,"pass_issued",{pass_serial:o,user_agent:e.headers.get("user-agent")});let u=await s.arrayBuffer();return new i.Z(u,{status:200,headers:{"Content-Type":"application/vnd.apple.pkpass","Content-Disposition":`attachment; filename="hushh-gold-${r}.pkpass"`,"Cache-Control":"no-cache"}})}catch(e){return console.error("Failed to call Hushh Wallet API:",e),await p(r,"api_error",{error:"wallet_api_failed",message:e instanceof Error?e.message:"Unknown error"}),i.Z.json({error:"Pass generation service unavailable"},{status:503})}}catch(e){return console.error("Pass generation error:",e),i.Z.json({error:"Internal server error"},{status:500})}}async function d(){return i.Z.json({},{status:200})}let h=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/passes/gold/route",pathname:"/api/passes/gold",filename:"route",bundlePath:"app/api/passes/gold/route"},resolvedPagePath:"/Users/ankitkumarsingh/Desktop/hushh social card/hushh-gold-pass-mvp/src/app/api/passes/gold/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:f,headerHooks:v,staticGenerationBailout:y}=h,b="/api/passes/gold/route";function I(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},6517:(e,t,r)=>{r.d(t,{p:()=>s});var a=r(9224);(0,a.eI)("https://ntwdvvzjkmabujwxlzej.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im50d2R2dnpqa21hYnVqd3hsemVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzE3MTM4NTcsImV4cCI6MjA0NzI4OTg1N30.vQCDCT-yJjOhBjCvJk7Q5mJGwpMjkKHqo7LDZgG3lBI");let s=(0,a.eI)("https://ntwdvvzjkmabujwxlzej.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206,224],()=>r(1561));module.exports=a})();