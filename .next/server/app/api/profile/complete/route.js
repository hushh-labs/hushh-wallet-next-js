"use strict";(()=>{var e={};e.id=910,e.ids=[910],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2308:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>I,patchFetch:()=>k,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>_,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>v});var a={};r.r(a),r.d(a,{OPTIONS:()=>c,POST:()=>d});var s=r(5419),o=r(9108),n=r(9678),i=r(8070),l=r(6517),u=r(5635);async function p(e,t,r={}){try{await l.p.from("pass_events").insert({uid:e,type:t,meta_json:r})}catch(e){console.error("Failed to log event:",e)}}async function d(e){try{let{uid:t,token:r,city:a,state:s,zip:o,gender:n,age:d,street1:c}=await e.json();if(!t||!r)return i.Z.json({error:"UID and token are required."},{status:400});let{data:f,error:m}=await l.p.from("members").select("uid, edit_token_hash, name").eq("uid",t).single();if(m||!f)return i.Z.json({error:"Member not found."},{status:404});let h=!1;if((0,u.Tl)(r,f.edit_token_hash)&&(h=!0),!h&&(0,u.Tl)(r.replace(/-/g,""),f.edit_token_hash)&&(h=!0),!h&&(0,u.Tl)(r.replace(/[^a-zA-Z0-9]/g,""),f.edit_token_hash)&&(h=!0),!h&&r.length>16){let e=r.substring(0,16);(0,u.Tl)(e,f.edit_token_hash)&&(h=!0)}if(!h&&r.length>10)for(let e=1;e<=3;e++){let t=r.slice(0,-e);if((0,u.Tl)(t,f.edit_token_hash)){h=!0;break}}if(!h)return await p(t,"token_verification_failed",{original_token:r,user_agent:e.headers.get("user-agent")}),i.Z.json({error:"Invalid or expired token."},{status:403});await p(t,"token_verified",{user_agent:e.headers.get("user-agent"),had_token_issues:r!=r});let _={},g=[];if(a&&(_.profile_city=a.trim()),s&&(/^[A-Z]{2}$/.test(s.toUpperCase())?_.profile_state=s.toUpperCase():g.push("State must be a 2-letter US state code (e.g., CA, NY).")),o&&(/^\d{5}(-?\d{4})?$/.test(o)?_.profile_zip=o:g.push("ZIP code must be 5 digits or 5+4 format (e.g., 12345 or 12345-6789).")),n&&(["male","female","m","f"].includes(n.toLowerCase())?_.profile_gender=function(e){let t=e.toLowerCase();return"m"===t||"male"===t?"male":"f"===t||"female"===t?"female":t}(n):g.push("Gender must be male/female or M/F.")),void 0!==d&&(Number.isInteger(d)&&d>=13&&d<=120?_.profile_age=d:g.push("Age must be between 13 and 120.")),c&&(_.profile_street1=c.trim()),g.length>0)return i.Z.json({error:"Validation failed.",details:g},{status:400});if(0===Object.keys(_).length)return await p(t,"profile_opened",{user_agent:e.headers.get("user-agent")}),i.Z.json({ok:!0,message:"Profile accessed successfully.",member:f.name});_.profile_last_updated_at=new Date().toISOString();try{let{error:r}=await l.p.from("members").update(_).eq("uid",t);if(r)return console.error("Failed to update member profile:",r),i.Z.json({error:"Failed to update profile."},{status:500});return await p(t,"profile_saved",{user_agent:e.headers.get("user-agent"),fields_updated:Object.keys(_).filter(e=>"profile_last_updated_at"!==e),profile_complete:!!(_.profile_city&&_.profile_state&&_.profile_zip&&_.profile_gender&&_.profile_age)}),i.Z.json({ok:!0,message:"Profile updated successfully.",member:f.name,updated_fields:Object.keys(_).filter(e=>"profile_last_updated_at"!==e)})}catch(e){return console.error("Database error during profile update:",e),i.Z.json({error:"Database operation failed."},{status:500})}}catch(e){return console.error("Profile completion API error:",e),i.Z.json({error:"Internal server error."},{status:500})}}async function c(){return i.Z.json({},{status:200})}let f=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/profile/complete/route",pathname:"/api/profile/complete",filename:"route",bundlePath:"app/api/profile/complete/route"},resolvedPagePath:"/Users/ankitkumarsingh/Desktop/hushh social card/hushh-gold-pass-mvp/src/app/api/profile/complete/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:_,headerHooks:g,staticGenerationBailout:v}=f,I="/api/profile/complete/route";function k(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:h})}},6517:(e,t,r)=>{r.d(t,{p:()=>s});var a=r(9224);(0,a.eI)("https://ntwdvvzjkmabujwxlzej.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im50d2R2dnpqa21hYnVqd3hsemVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzE3MTM4NTcsImV4cCI6MjA0NzI4OTg1N30.vQCDCT-yJjOhBjCvJk7Q5mJGwpMjkKHqo7LDZgG3lBI");let s=(0,a.eI)("https://ntwdvvzjkmabujwxlzej.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})},5635:(e,t,r)=>{r.d(t,{pq:()=>s,Ux:()=>n,AH:()=>p,QB:()=>i,Jj:()=>d,D:()=>o,IR:()=>l,Tl:()=>u});let a=require("crypto");function s(e){let t=e.email.toLowerCase().trim(),r=e.name.trim().replace(/\s+/g," "),a=function(e){let t=e.replace(/\D/g,"");return 10===t.length?`+1${t}`:11===t.length&&t.startsWith("1")?`+1${t.substring(1)}`:null}(e.phone);return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)&&r.trim().length>0&&a?{name:r,email:t,phone_e164:a}:null}function o(e){let t=process.env.UID_SECRET_SALT;if(!t)throw Error("UID_SECRET_SALT environment variable is required");let r=e.name.toLowerCase(),s=`${e.email}|${e.phone_e164}|${r}`,o=(0,a.createHmac)("sha256",t);o.update(s);let n=o.digest().subarray(0,20),i=0n;for(let e=0;e<n.length;e++)i=(i<<8n)+BigInt(n[e]);return i.toString(36)}function n(){return(0,a.randomBytes)(8).toString("hex")}function i(){return(0,a.randomBytes)(4).toString("hex")}function l(e){return(0,a.createHash)("sha256").update(e).digest("hex")}function u(e,t){return l(e)===t}function p(e,t){let r=process.env.NEXT_PUBLIC_APP_URL||"https://hushh-gold-pass-mvp.vercel.app";return{public_url:`${r}/u/${e}`,profile_url:`${r}/complete/${e}?token=${t}`}}function d(e){let t=process.env.NEXT_PUBLIC_APP_URL||"https://hushh-gold-pass-mvp.vercel.app";return`${t}/s/${e}`}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206,224],()=>r(2308));module.exports=a})();